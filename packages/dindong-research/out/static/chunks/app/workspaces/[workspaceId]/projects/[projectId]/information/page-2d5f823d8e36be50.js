(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{14748:function(e,r,t){Promise.resolve().then(t.bind(t,48629))},48629:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return ei}});var l=t(57437),n=t(18051),s=t(28868),i=t(97882),o=t(534),a=t(51954),d=t(30620),c=t(72574),u=t(50707),x=t(80281),m=t(93579),p=t(84648),v=t(6659),h=t(96544),j=t(44857),f=t(9152),g=t(2265),Z=t(79442),b=t(90709),y=t(36935),T=t(59666),D=t(32129),P=t(62889),k=t(25328),q=t(86103),w=t.n(q),C=t(40292),F=t.n(C);w().extend(F());let W={startTime:null,endTime:null,maxParticipants:1},I=e=>{if(!e)return null;if((0,q.isDayjs)(e))return e;let[r,t,l]=e.split(":");return w()().set("hour",parseInt(r)).set("minute",parseInt(t)).set("second",parseInt(l))},Q=(e,r,t)=>{for(let[l,n]of null==r?void 0:r.entries())if(e.isBetween(n.startTime,n.endTime,"minute","[]")&&t>l)return!0;return!1};var O=()=>{var e;let{control:r,setValue:t}=(0,P.Gc)(),s=null!==(e=(0,P.qo)({control:r,name:"experimentTimeslots"}))&&void 0!==e?e:[];return(0,l.jsxs)(n.Z,{gap:2,children:[s.map((e,i)=>(0,l.jsxs)(x.Z,{display:"flex",gap:2,children:[(0,l.jsxs)(u.Z,{variant:"caption",sx:{mt:1.2},children:["세션 ",i+1]}),(0,l.jsxs)(n.Z,{flexDirection:"row",divider:(0,l.jsx)(x.Z,{sx:{mt:1.2},children:"~"}),gap:2,flexGrow:1,children:[(0,l.jsx)(P.Qr,{control:r,rules:{required:{value:!0,message:"세션 시간을 입력해주세요."},validate:e=>{if(Q(e,s,i))return"중복된 시간을 입력할 수 없습니다."}},name:"experimentTimeslots.".concat(i,".startTime"),render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(D.j,{...t,value:"string"==typeof t.value?I(t.value):t.value,slots:{openPickerIcon:Z.FO},slotProps:{textField:{fullWidth:!0,helperText:null===(r=n.error)||void 0===r?void 0:r.message,error:!!n.error}}})}},i),(0,l.jsx)(P.Qr,{control:r,rules:{required:{value:!0,message:"세션 시간을 입력해주세요."},validate:r=>{if(Q(r,s,i))return"중복된 시간을 입력할 수 없습니다.";if(r&&(null==e?void 0:e.startTime)){let t=e.startTime;if(!(null==r?void 0:r.isAfter(t)))return"시작 시간보다 늦은 시간을 입력해주세요."}return!0}},name:"experimentTimeslots.".concat(i,".endTime"),render:e=>{var r,t;let{field:n,fieldState:o}=e;return(0,l.jsx)(D.j,{...n,value:"string"==typeof n.value?I(n.value):n.value,slots:{openPickerIcon:Z.FO},slotProps:{textField:{fullWidth:!0,helperText:null===(r=o.error)||void 0===r?void 0:r.message,error:!!o.error}},minTime:null===(t=s[i])||void 0===t?void 0:t.startTime})}})]}),(0,l.jsx)(P.Qr,{control:r,rules:{required:{value:!0,message:"참가 인원을 입력해주세요."},min:{value:1,message:"1명 이상의 참가 인원을 입력해주세요."}},name:"experimentTimeslots.".concat(i,".maxParticipants"),render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(Z.nv,{...t,sx:{maxWidth:220},type:"number",helperText:null===(r=n.error)||void 0===r?void 0:r.message,error:!!n.error,endAdornment:(0,l.jsx)(m.Z,{position:"end",children:"명"})})}}),(0,l.jsx)("span",{children:(0,l.jsx)(y.Z,{disabled:1===s.length,onClick:()=>t("experimentTimeslots",s.filter((e,r)=>r!==i)),sx:{mt:.3},children:(0,l.jsx)(k.Z,{fontSize:"small"})})})]},i)),(0,l.jsx)(T.Z,{color:"inherit",onClick:()=>t("experimentTimeslots",[...s,W]),children:"세션 추가"})]})},S=t(22076),E=t(78888),Y=t(54460),N=t(64861),R=()=>{let{control:e}=(0,P.Gc)();return(0,l.jsx)(S.Z,{sx:{position:"fixed",bottom:0,top:"auto",left:N.drawerWidth,right:0},children:(0,l.jsx)(E.Z,{children:(0,l.jsx)(s.Z,{maxWidth:"lg",children:(0,l.jsxs)(x.Z,{display:"flex",justifyContent:"space-between",children:[(0,l.jsx)(P.Qr,{control:e,name:"isPublic",render:e=>{let{field:r}=e;return(0,l.jsx)(i.Z,{labelPlacement:"start",label:"서베이 플랫폼에 공개하기",slotProps:{typography:{variant:"body1"}},...r,control:(0,l.jsx)(Y.Z,{checked:r.value})})}}),(0,l.jsx)(T.Z,{type:"submit",children:"저장"})]})})})})},V=t(94028),_=t(52803),L=t(88823),M=t(14349),z=e=>(0,l.jsx)(M.Z,{...e,sx:{bgcolor:"#3F57FD1F",color:"#3F57FD",fontWeight:500,paddingRight:"4px"},deleteIcon:(0,l.jsx)("i",{className:"fa-solid fa-xmark",style:{color:"#3F57FD",fontSize:"15px"}})}),A=t(8396),B=t(62309),G=t(99251),U=t(86009),H=t(93575);let $="YYYY. MM. DD.",K=e=>0===e.day()||6===e.day(),J=(e,r,t)=>{if(!e||!r)return[];let l=[],n=w()(e),s=w()(r);for(;n.isBefore(s);n=n.add(1,"day")){let e=n.format($);K(n)&&!t.includes(e)&&l.push(e)}return l},X=(e,r,t)=>!!e&&!!r&&J(e,r,t).map(e=>t.includes(e)).every(Boolean);var ee=e=>{let{value:r,onChange:t}=e,{control:s}=(0,P.Gc)(),o=(0,P.qo)({control:s,name:"startDate"}),a=(0,P.qo)({control:s,name:"endDate"}),[d,c]=g.useState(!1),[u,m]=g.useState(null);return g.useEffect(()=>{c(X(o,a,r))},[r,a,o]),(0,l.jsxs)(x.Z,{children:[(0,l.jsx)(Z.nv,{readOnly:!0,fullWidth:!0,placeholder:"제외할 날짜를 선택해주세요.",endAdornment:(0,l.jsx)(Z.Dc,{}),sx:{cursor:"pointer"},inputProps:{style:{cursor:"pointer"}},onClick:e=>m(e.currentTarget)}),(0,l.jsxs)(U.ZP,{open:!!u,anchorEl:u,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},slotProps:{paper:{sx:{borderRadius:2}}},onClose:()=>m(null),children:[(0,l.jsx)(H.W,{value:null,minDate:o,maxDate:a,slotProps:{day:e=>r.includes(e.day.format($))?{sx:{":focus":{backgroundColor:e=>e.palette.secondary.main,color:"white"},backgroundColor:e=>e.palette.secondary.main,color:"white","&:hover":{backgroundColor:e=>e.palette.secondary.main,opacity:.8}}}:{}},onChange:e=>{r.includes(e.format($))?t(r.filter(r=>r!==e.format($))):t([...r,e.format($)])}}),(0,l.jsxs)(n.Z,{gap:1,p:3,pt:0,direction:"row",justifyContent:"space-between",children:[(0,l.jsx)(i.Z,{label:"주말 제외",control:(0,l.jsx)(Y.Z,{checked:d,value:d,onChange:e=>{e.target.checked?(c(!0),t([...r,...J(o,a,r)])):(c(!1),t(r.filter(e=>!K(w()(e)))))}}),labelPlacement:"start"}),(0,l.jsx)(T.Z,{color:"inherit",onClick:()=>t([]),children:"초기화"})]})]})]})},er=t(28053),et=t(10867);w().extend(F());let el="YYYY-MM-DD",en="HH:mm:ss",es=w()();function ei(){var e;let r=(0,et.useQueryClient)(),{enqueueSnackbar:t}=(0,B.Ds)(),{workspaceId:y,projectId:T}=(0,L.useParams)(),{project:D}=(0,_.P)({workspaceId:Number(y),projectId:Number(T)}),k=(0,P.cI)({defaultValues:D}),[q,C]=g.useState(!!(null==D?void 0:D.excludedDates.length)),F=(0,P.qo)({name:"startDate",control:k.control}),Q=(0,P.qo)({name:"endDate",control:k.control}),S=(0,P.qo)({name:"experimentType",control:k.control}),E=(0,P.qo)({name:"experimentTimeslots",control:k.control}),Y=(0,P.qo)({name:"excludedDates",control:k.control}),N=null==E?void 0:E.reduce((e,r)=>e+Number(r.maxParticipants),0),M=(w()(Q).diff(F,"day")+1-(null==Y?void 0:Y.length))*N;g.useEffect(()=>{if(D){var e,r,t;k.reset({...D,experimentTimeslots:D.experimentTimeslots.map(e=>({...e,startTime:I(e.startTime),endTime:I(e.endTime)})),startDate:w()(D.startDate),endDate:w()(D.endDate)}),(null==D?void 0:null===(e=D.experimentTimeslots)||void 0===e?void 0:e.length)||k.setValue("experimentTimeslots",[W]),(null==D?void 0:D.endDate)||k.setValue("endDate",es.add(1,"month")),(null==D?void 0:D.startDate)||k.setValue("startDate",es),(null==D?void 0:null===(r=D.experimentTimeslots)||void 0===r?void 0:r.length)||k.setValue("experimentTimeslots",[W]),C(!!(null===(t=D.excludedDates)||void 0===t?void 0:t.length))}},[k,D]);let U=k.handleSubmit(async e=>{try{var l;await A.Z.put("/workspaces/".concat(y,"/projects/").concat(T),{...e,startDate:w()(e.startDate).format(el),endDate:w()(e.endDate).format(el),experimentTimeslots:e.experimentTimeslots.map(e=>{var r,t;return{...e,startTime:null===(r=e.startTime)||void 0===r?void 0:r.format(en),endTime:null===(t=e.endTime)||void 0===t?void 0:t.format(en)}}),excludedDates:q?null===(l=e.excludedDates)||void 0===l?void 0:l.map(e=>w()(e).format(el)):[]},{params:{project_type:G.I.Experiment}}),r.invalidateQueries({queryKey:[_.G]}),t("프로젝트 정보가 성공적으로 저장되었습니다.",{variant:"success"})}catch(e){t("프로젝트 정보를 저장하는 중 오류가 발생했습니다.",{variant:"error"})}});return g.useEffect(()=>{k.setValue("excludedDates",null==Y?void 0:Y.filter(e=>w()(e).isBetween(F,Q,"day","[]")))},[Q,F]),(0,l.jsx)(P.RV,{...k,children:(0,l.jsxs)(n.Z,{width:"100%",sx:{position:"relative",pb:"64px"},component:"form",onSubmit:U,children:[(0,l.jsx)(s.Z,{maxWidth:"lg",children:(0,l.jsxs)(n.Z,{gap:4,children:[(0,l.jsx)(Z.mr,{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(er.Z,{size:"small",isPublic:!!(null==D?void 0:D.isPublic),sx:{mr:1.5}}),null==D?void 0:D.title]})}),(0,l.jsxs)(Z.rZ,{title:"기본 정보",children:[(0,l.jsx)(P.Qr,{name:"title",control:k.control,rules:{required:{value:!0,message:"필수 입력 항목입니다."}},render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(Z.nv,{label:"프로젝트 명",error:n.invalid,helperText:null===(r=n.error)||void 0===r?void 0:r.message,required:!0,fullWidth:!0,...t})}}),(0,l.jsx)(P.Qr,{name:"description",control:k.control,rules:{required:{value:!0,message:"필수 입력 항목입니다."}},render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(Z.nv,{label:"프로젝트 설명",placeholder:"프로젝트 설명을 입력해주세요.",rows:3,error:n.invalid,helperText:null===(r=n.error)||void 0===r?void 0:r.message,multiline:!0,required:!0,fullWidth:!0,...t})}})]}),(0,l.jsxs)(Z.rZ,{title:"일시 및 인원",children:[(0,l.jsxs)(n.Z,{gap:1,children:[(0,l.jsx)(Z.Lr,{label:"예약 가능 날짜",description:"참여자가 실험에 예약할 수 있는 날짜를 지정합니다.",labelProps:{required:!0}}),(0,l.jsxs)(n.Z,{children:[(0,l.jsxs)(n.Z,{display:"flex",flexDirection:"row",alignItems:"center",divider:(0,l.jsx)("span",{children:"~"}),gap:2,children:[(0,l.jsx)(P.Qr,{name:"startDate",control:k.control,rules:{required:{value:!0,message:"필수 입력 항목입니다."}},render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(V.M,{slots:{openPickerIcon:Z.Dc},slotProps:{textField:{fullWidth:!0,error:n.invalid,helperText:null===(r=n.error)||void 0===r?void 0:r.message}},...t,value:w()(t.value)})}}),(0,l.jsx)(P.Qr,{name:"endDate",control:k.control,rules:{required:{value:!0,message:"필수 입력 항목입니다."}},render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(V.M,{slots:{openPickerIcon:Z.Dc},slotProps:{textField:{fullWidth:!0,error:n.invalid,helperText:null===(r=n.error)||void 0===r?void 0:r.message}},...t,value:w()(t.value),minDate:F})}})]}),(0,l.jsx)(P.Qr,{name:"excludedDates",control:k.control,render:e=>{var r,t;let{field:s}=e;return(0,l.jsxs)(n.Z,{children:[(0,l.jsx)(i.Z,{label:"제외할 날짜 사용",componentsProps:{typography:{variant:"body2"}},sx:{width:"fit-content"},control:(0,l.jsx)(o.Z,{checked:q,onChange:e=>C(e.target.checked)})}),(0,l.jsx)(a.Z,{in:q,children:(0,l.jsx)(d.Z,{elevation:0,sx:{bgcolor:"#F8FAFB",borderRadius:4},children:(0,l.jsxs)(c.Z,{component:n.Z,sx:{gap:2},children:[(0,l.jsx)(ee,{value:s.value,onChange:s.onChange}),(null===(r=s.value)||void 0===r?void 0:r.length)>0?(0,l.jsxs)(n.Z,{gap:1,children:[(0,l.jsx)(u.Z,{variant:"body2",fontWeight:700,children:"제외할 날짜 목록"}),(0,l.jsx)(x.Z,{display:"flex",gap:1,flexWrap:"wrap",children:null===(t=s.value)||void 0===t?void 0:t.map(e=>(0,l.jsx)(z,{label:e,onDelete:()=>{s.onChange(s.value.filter(r=>r!==e))}},e))})]}):null]})})})]})}})]})]}),(0,l.jsxs)(n.Z,{gap:1,children:[(0,l.jsx)(Z.Lr,{label:"실험 시작/종료 시간",description:"예약 가능한 실험 시작 및 종료 시간을 설정합니다. 입력된 시간은 여러 개의 실험 세션으로 지정되며, 일 단위로 관리됩니다.\n참여자는 예약 가능 날짜 범위 내에서 참여 가능한 시간대를 선택하여 예약 가능합니다.",labelProps:{required:!0}}),(0,l.jsx)(O,{})]}),(0,l.jsxs)(n.Z,{gap:1,children:[(0,l.jsx)(Z.Lr,{label:"참여자 수 제한",description:"실험에 참여 가능한 인원 수를 설정합니다. 입력 가능한 최대 참여자 수는 예약 가능 날짜 및 실험 시작/종료 시간을 기준으로 계산됩니다.",labelProps:{required:!0}}),(0,l.jsx)("span",{children:(0,l.jsx)(P.Qr,{name:"maxParticipants",control:k.control,rules:{required:{value:!0,message:"필수 입력 항목입니다."},min:{value:1,message:"1명 이상 입력해주세요."},max:{value:M,message:"참여 가능한 최대 참가자 수는 ".concat(M,"명입니다.")}},render:e=>{var r;let{field:t,fieldState:n}=e;return(0,l.jsx)(Z.nv,{required:!0,type:"number",endAdornment:(0,l.jsx)(m.Z,{position:"end",children:"명"}),error:n.invalid,helperText:(null===(r=n.error)||void 0===r?void 0:r.message)||(0,l.jsxs)("span",{children:["참여 가능한 최대 참가자 수는"," ",(0,l.jsx)("b",{children:M}),"명입니다."]}),...t})}})})]})]}),(0,l.jsxs)(Z.rZ,{title:"실험 유형",children:[(0,l.jsx)(P.Qr,{name:"experimentType",control:k.control,render:e=>{let{field:r}=e;return(0,l.jsxs)(p.Z,{...r,exclusive:!0,sx:{width:"420px"},children:[(0,l.jsx)(v.Z,{value:G.$y.Offline,children:"대면"}),(0,l.jsx)(v.Z,{value:G.$y.Online,children:"비대면"})]})}}),(0,l.jsx)(n.Z,{children:(0,l.jsx)(P.Qr,{name:"location",control:k.control,render:e=>{let{field:r}=e;return"online"===S?(0,l.jsx)(Z.nv,{label:"참여 URL",helperText:"비대면 실험 참여를 위한 URL이 있는 경우 입력해 주세요. 입력된 URL은 예약이 완료된 참여자에 한하여 모바일 앱 채팅 알림으로 전송됩니다.",fullWidth:!0,...r}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.Z,{required:!0,children:"실험 장소"}),(0,l.jsx)(b.kS,{}),(0,l.jsx)(j.Z,{children:"실험 진행을 위한 주소를 입력할 수 있습니다. 주소는 참여자에게 공개됩니다."})]})}})}),(0,l.jsxs)(n.Z,{gap:.5,children:[(0,l.jsx)(u.Z,{variant:"body1",fontWeight:700,children:"참여 코드"}),(0,l.jsxs)(x.Z,{display:"flex",gap:1.5,alignItems:"center",children:[(0,l.jsx)(f.Z,{readOnly:!0,value:null==D?void 0:D.participantCode}),(0,l.jsx)(b.mo,{content:null!==(e=null==D?void 0:D.participantCode)&&void 0!==e?e:""})]}),(0,l.jsx)(j.Z,{sx:{whiteSpace:"pre-wrap"},children:"참여자의 실험 참여 여부를 체크하기 위한 참여코드가 발급됩니다.\n참여자는 실험 참여 10분 전 또는 참여 이후 모바일 앱을 통해 해당코드를 입력하여 참여 완료 여부를 입력할 수 있습니다."})]})]})]})}),(0,l.jsx)(R,{})]})})}}},function(e){e.O(0,[759,110,52,745,601,656,698,439,971,54,744],function(){return e(e.s=14748)}),_N_E=e.O()}]);